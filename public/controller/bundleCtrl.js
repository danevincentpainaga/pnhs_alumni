var app;angular.module("pnhsApp").directive("emoji",["$sce",function(e){return{restrict:"A",scope:{description:"="},link:function(t,n,o){window.emojioneVersion="3.1.2",$(n).emojioneArea({pickerPosition:"bottom",saveEmojisAs:"shortname",shortnames:!0}),n[0].emojioneArea.on("change",function(o,i){t.description=e.trustAsJs($(n)[0].emojioneArea.getText()),t.$apply(t.description)}),t.$watch("description")}}}]),(app=angular.module("pnhsApp")).filter("checkImage",function(){return function(e){return-1!=["image/jpg","image/jpeg","image/png","image/gif"].indexOf(e)}}),app.filter("checkVideo",function(){return function(e){return"video/mp4"==e}}),app.filter("checkPhoto",function(){return function(e){return e||"images/avatarmale.svg"}}),app.filter("formatDate",function(){return function(e){if(e)return moment(e).startOf("hour").fromNow()}}),app.filter("formatDescription",["$sce",function(e){return function(t){let n=new EmojiConvertor;return n.img_set="facebook",n.img_sets.facebook.path="node_modules/emoji-datasource-facebook/img/facebook/64/",e.trustAsHtml(n.replace_colons(t))}}]),(app=angular.module("pnhsApp")).controller("loginCtrl",["$scope","$rootScope","$cookies","$window","$location","$timeout","apiService","swalert",function(e,t,n,o,i,a,s,r){var l=this;l.valid=!0,l.buttonMessage="Sign In",l.loginBtn=!1,l.login=function(){if(l.email&&l.password){l.buttonMessage="Signing In...",l.loginBtn=!0;var t={email:l.email,password:l.password};s.validateLogin(t).then(function(t){n.putObject("auth",t.data),console.log(t),i.path("/dashboard"),e.$emit("Authenticated"),l.loginBtn=!1},function(e){console.log(e),l.buttonMessage="Sign In",l.loginBtn=!1})}else console.log("unAuthenticated")}}]),(app=angular.module("pnhsApp")).controller("mainCtrl",["$scope","$rootScope","$location","$state","$http","$filter","$timeout","$cookies","$window","$stateParams","$q","swalert","fileReader","apiService","Upload",function(e,t,n,o,i,a,s,r,l,c,p,u,d,g,f){e.$on("load_start",function(t,n){e.$broadcast("loading_value",n)}),e.$on("upload_finished",function(t,n){e.$broadcast("finished",n)}),e.$on("uploaded_file",function(t,n){e.$broadcast("uploadedfile",n)})}]),app.directive("menuDirective",function(){return{restrict:"E",scope:{},templateUrl:"views/menu.html"}}),app.directive("newsFeedDirective",function(){return{restrict:"E",scope:{},templateUrl:"views/newsfeed_directive.html",controller:"newsfeedCtrl",controllerAs:"nf"}}),app.directive("postedFeedDirective",function(){return{restrict:"E",scope:{userpost:"="},templateUrl:"views/posted_feed_directive.html",controller:"postedFeedCtrl",controllerAs:"p"}}),app.directive("rightColumnDirective",function(){return{restrict:"E",scope:{},templateUrl:"views/officers_friends_directive.html"}}),app.directive("files",function(){return{restrict:"A",scope:{filedata:"@filedata",files:"="},link:function(e,t,n){e.$watch("filedata",function(e,t){e&&JSON.parse(e).forEach(function(e,t){if("video"==e.type.slice(0,e.type.indexOf("/")))var n=$("<video />",{id:t,src:e.result,alt:"",controls:!0,width:"100%"});else var n=$("<img />",{id:t,src:e.result,alt:"",width:"100%"});n.appendTo($("#file-holder"))})})}}}),angular.module("pnhsApp").directive("modalDirective",function(){return{restrict:"E",templateUrl:"views/popup_post_modal.html",controller:"postsCtrl",controllerAs:"p",link:function(e,t,n){t.on("click",function(e){(e.target==e.currentTarget||$(e.target).hasClass("close-post-modal"))&&($("body").css({overflow:"auto"}),$("#pop-up-post-modal").css({display:"none"}))})}}}),(app=angular.module("pnhsApp")).controller("newsfeedCtrl",["$scope","$rootScope","$location","$state","$http","$filter","$timeout","$cookies","$window","$stateParams","$q","swalert","fileReader","apiService","Upload",function(e,t,n,o,i,a,s,r,l,c,p,u,d,g,f){var m=this;m.uploading=!1,e.$on("loading_value",function(e,t){m.percentage=t,m.uploading=!0}),e.$on("finished",function(e,t){m.uploading=t.bool,m.uploadedFiles=t.post_images}),e.$on("uploadedfile",function(e,t){m.uploading||(m.uploading=!0),m.uploadedfile=t}),g.getPost().then(function(e){m.post=e.data,console.log(m.post)},function(e){console.log(e)})}]),angular.module("pnhsApp").directive("openModal",function(){return{restrict:"A",link:function(e,t,n){t.on("click",function(e){$("body").css({overflow:"hidden"}),$("#pop-up-post-modal").css({display:"block"})})}}}),angular.module("pnhsApp").directive("popUpPostWrapper",function(){return{restrict:"A",template:'<div ng-class="ngClass"><div ng-repeat="f in pf track by $index"><img ng-src="{{ f.result }}" ng-if="f.type | checkImage"><div class="video-wrap" ng-if="f.type | checkVideo" ><video><source ng-src="{{ f.result }}" type="video/mp4"/></video> <figure><button name="play"></button></figure> </div></div></div>',scope:{postfiles:"="},link:function(e,t,n){function o(t,n,o){if(t.length===n||5===n){switch(e.checkDimension(o)){case"even":case"portrait":e.ngClass="post-photo-grid-wrapper",e.$apply(e.ngClass);break;case"landscape":e.ngClass="post-photo-grid-wrapper-landscape",e.$apply(e.ngClass)}e.pf=t.slice(0,5),e.$apply(e.pf),console.log(e.pf)}}e.$watch("postfiles",function(t,n){t&&e.preLoadFiles(t)}),e.preLoadFiles=function(e){let t=0,n=[{value:0,name:"landscape"},{value:0,name:"portrait"},{value:0,name:"even"}];for(i=0;i<e.length;i++){if(i>4)return t=0,!1;let a=new Image;a.onload=function(i){t++,a.naturalWidth>a.naturalHeight?n[0].value+=1:a.naturalWidth<a.naturalHeight?n[1].value+=1:a.naturalWidth==a.naturalHeight&&(n[2].value+=1),o(e,t,n)},"video/mp4"!=e[i].type?a.src=e[i].result:o(e,++t,n)}},e.checkDimension=function(e){for(i=0;i<e.length;i++)e[0].value<e[i].value&&(e[0]=e[i]);return e[0].name}}}}),(app=angular.module("pnhsApp")).controller("postedFeedCtrl",["$scope","$rootScope","$location","$state","$http","$filter","$timeout","$cookies","$window","$stateParams","$q","swalert","fileReader","apiService","Upload",function(e,t,n,o,i,a,s,r,l,c,p,u,d,g,f){}]),angular.module("pnhsApp").directive("postGridWrapper",function(){return{restrict:"A",template:'<div ng-class="ngClass"><div ng-repeat="f in pf track by $index"><img ng-src="storage/{{ f.image_name }}" ng-if="f.mime_type | checkImage"><div class="video-wrap" ng-if="f.mime_type | checkVideo" ><video><source ng-src="storage/{{ f.image_name }}" type="video/mp4"/></video> <figure><button name="play"></button></figure> </div></div></div>',scope:{postfiles:"="},link:function(e,t,n){function o(t,n,o){if(t.length===n||5===n){switch(e.checkDimension(o)){case"even":case"portrait":e.ngClass="post-photo-grid-wrapper",e.$apply(e.ngClass);break;case"landscape":e.ngClass="post-photo-grid-wrapper-landscape",e.$apply(e.ngClass)}e.pf=t.slice(0,5),e.$apply(e.pf)}}e.$watch("postfiles",function(t,n){t&&e.preLoadFiles(t)}),e.preLoadFiles=function(e){let t=0,n=[{value:0,name:"landscape"},{value:0,name:"portrait"},{value:0,name:"even"}];for(i=0;i<e.length;i++){if(i>4)return t=0,!1;let a=new Image;a.onload=function(i){t++,a.naturalWidth>a.naturalHeight?n[0].value+=1:a.naturalWidth<a.naturalHeight?n[1].value+=1:a.naturalWidth==a.naturalHeight&&(n[2].value+=1),o(e,t,n)},"video/mp4"!=e[i].mime_type?a.src="storage/"+e[i].image_name:o(e,++t,n)}},e.checkDimension=function(e){for(i=0;i<e.length;i++)e[0].value<e[i].value&&(e[0]=e[i]);return e[0].name}}}}),(app=angular.module("pnhsApp")).controller("postsCtrl",["$scope","$rootScope","$location","$state","$http","$filter","$timeout","$cookies","$window","$stateParams","$q","swalert","fileReader","apiService","Upload","$sce",function(e,t,n,o,i,a,s,r,l,c,p,u,d,g,f,m){var h=this,$=[],v=[];function w(e,t,n){if(e&&e.length)for(var o=0;o<e.length;o++)y(_(e[o]),t,n)}function _(e){let n=e.lastModified+"_"+e.size+"_"+e.name.slice(0,e.name.lastIndexOf(".")),o=n+"_pnhsKey."+e.name.slice(e.name.lastIndexOf(".")+1);return f.upload({url:"api/uploadFiles",data:{file:f.rename(e,o)},resumeSizeUrl:baseUrl+"api/checkChunk/"+n,headers:{Authorization:"Bearer "+t.token},resumeChunkSize:h.filesize})}function y(t,n,o){e.$emit("load_start",2),t.then(function(e){if($.push({name:e.data.name,path:e.data.path,mime_type:e.data.mime_type.replace("-","/"),description:"No description"}),v.push({src:"storage/"+e.data.path+e.data.name,alt:"",title:"",caption:h.desc,thumbnail:"storage/"+e.data.path+e.data.name}),$.length==h.file.length){h.privacy_status,h.desc;k(n,o)}console.log("mime_type: "+e.data.mime_type.replace("-","/"))},function(e){console.log("Error status: "+e.status)},function(t){s(()=>{h.postingInProgress=!1},1e3);var n=parseInt(100*t.loaded/t.total);e.$emit("load_start",n),e.$emit("uploaded_file",{fileName:t.config.data.file.name}),console.log("progress: "+n+"% "+t.config.data.file.name)})}function k(t,n){let o;"savePostDescriptionOnly"==t.name&&(e.$emit("load_start",-1),o=2e3,s(()=>{h.postingInProgress=!1},100)),t({post:n}).then(function(t){console.log(t.data),s(()=>{e.$emit("upload_finished",{bool:!1,post_images:v})},o)},function(e){console.log(e)})}h.post_status="Share",h.privacy=["public","friends"],h.privacy_status="public",h.show_tagged_limit=1,h.filesize=2e6,e.$watch("status",function(e,t){h.show_suggestions=e}),e.$on("taggedUsers",function(e,t){h.tagged_users=t,h.tagged=!0}),e.$watch("p.tagged_users",function(e,t){if(e){let t=function(e){if(2==e.length)return 2;return 1}(e);1==t&&(h.others=e.length-t,h.tagged=e.length>0),h.hasOthers=e.length>2,h.show_tagged_limit=t}},!0),h.tagFriends=function(){h.show_suggestions=!0},h.uploadPost=function(){h.desc=m.getTrustedJs(h.post_description),!1===function(e,t){if(!e&&t)return k(g.savePostDescriptionOnly,{post_description:h.desc,privacy:h.privacy_status,taggedUsers:h.tagged_users});if(!t&&e)return w(h.file,g.savePostFilesOnly,{files:$,privacy:h.privacy_status,taggedUsers:h.tagged_users});if(e&&t)return w(h.file,g.savePostDescriptionWithFiles,{files:$,post:{privacy:h.privacy_status,description:h.desc},taggedUsers:h.tagged_users});return!1}(h.file,h.desc)?console.log("Not Valid"):(h.post_status="Sharing",h.postingInProgress=!0)},h.getTheFiles=function(t){h.file=t,function(t){let n=[];angular.forEach(t,function(o,i){d.readAsDataUrl(o,e).then(function(e){n.push({name:o.name,type:o.type,result:e}),n.length!=t.length||(h.uploadedImage=n)},function(e){console.log(e)})})}(t)}}]),app.directive("file",function(){return{restrict:"A",link:function(e,t,n){t.on("click",function(){console.log(n.file)})}}}),app.factory("fileReader",function(e,t){return{readAsDataUrl:function(t,n){var o=e.defer();t?function(e,t){var n=new FileReader;return n.onload=function(e,t,n){return function(){n.$apply(function(){t.resolve(e.result)})}}(n,e,t),n.onerror=function(e,t,n){return function(){n.$apply(function(){t.reject(e.result)})}}(n,e,t),n.onprogress=function(e,t){return function(e){t.$broadcast("fileProgress",{total:e.total,loaded:e.loaded})}}(0,t),n}(o,n).readAsDataURL(t):o.reject(t);return o.promise}}}),angular.module("pnhsApp").directive("tagFriendsSuggestions",["$timeout",function(e){return{restrict:"E",scope:{status:"="},templateUrl:"views/tag_friends_suggesstions.html",controller:"taggedUserListCtrl",controllerAs:"tc",link:function(t,n,o){t.$watch("status",function(n,o){if(n){$("#tagged").animate({position:"absolute",right:"0px"},40);let n=angular.element(".tagged-body");t.getWindowDimensions=function(){return{h:n.height()}},t.$watch(t.getWindowDimensions,function(n,o){e(function(){$(".wrapper").css({height:n.h+25+"px"}),t.$apply(t.getWindowDimensions)},40)},!0),n.bind("resize",function(){t.$apply()})}else $(".wrapper").css({height:"auto"}),$("#tagged").animate({position:"absolute",right:"-530px"},150)},!0)}}}]),(app=angular.module("pnhsApp")).controller("taggedUserListCtrl",["$scope","$rootScope","$cookies","$window","$location","$timeout","apiService","swalert","debounce",function(e,t,n,o,i,a,s,r,l){var c=this;function p(e){c.loaded=!1,s.getSearchFriends(e).then(function(e){console.log(e),c.suggestions=e.data,c.loaded=!0},function(e){console.log(e)})}c.taggedUsers=[],c.hasTagged=!1,e.$watch("tc.search",l(function(){c.loaded&&p({search:c.search})},500),!0),e.$watch("status",function(e,t){e&&!c.loaded&&p()}),c.back=function(){e.status=!1},c.tagged=function(t){c.hasTagged=!0,0==c.taggedUsers.filter(e=>e.id==t.id)&&a(function(){c.taggedUsers.push({id:t.id,fullname:t.firstname+" "+t.lastname}),e.$emit("taggedUsers",c.taggedUsers)},10)},c.removeTagged=function(e){c.taggedUsers.length<2&&(c.hasTagged=!1),c.taggedUsers.splice(c.taggedUsers.indexOf(e),1)},c.doneTagging=function(){e.status=!1}}]),app.factory("debounce",function(e){return function(t,n){var o=null;return function(){e.cancel(o),o=e(function(){t.apply(this,arguments)},n)}}}),(app=angular.module("pnhsApp")).controller("uploadingProgressCtrl",["$scope","$rootScope","$location","$state","$http","$filter","$timeout","$cookies","$window","$stateParams","$q","swalert","fileReader","apiService","Upload",function(e,t,n,o,i,a,s,r,l,c,p,u,d,g,f){}]),app.directive("uploadProgressDirective",function(){var e=-1;return{restrict:"E",scope:{percentage:"@",fileuploaded:"="},templateUrl:"views/uploading_progress_directive.html",controller:"uploadingProgressCtrl",controllerAs:"up",link:function(t,n,o){o.$observe("percentage",function(n,o){let i=t.$eval(n);var a;-1==i?($("body").css({overflow:"auto"}),$("#pop-up-post-modal").css({display:"none"}),function e(t){t<100?(t+=1,$(".total-progress").css({width:t+"%"}),$("#message").text("Uploading "+t+"%"),setTimeout(()=>{e(t)},20)):($(".total-progress").css({width:"100%"}),$("#message").text("Finishing..."))}(0)):(setTimeout(()=>{$("body").css({overflow:"auto"}),$("#pop-up-post-modal").css({display:"none"})},700),e<=(a=i)&&(a>99?($(".total-progress").css({width:"99%"}),$("#message").text("Finishing...")):($(".total-progress").css({width:a+"%"}),$("#message").text("Uploading "+a+"%")),e=[a]))})}}});
